<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> C R Y P T O | Prices</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" 
    integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    
    <!--Navbar start-->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand ml-5 " href="/">
            <img src="https://img.icons8.com/office/30/000000/blockchain-new-logo.png" class="mr-2" />
            <b class="text-monospace"> C R Y P T O </b>
        </a>
        <div class="collapse navbar-collapse" id="navbarNavDropdown" style="align-self: right;">
          <ul class="navbar-nav ml-auto mr-5">
            <li class="nav-item">
              <a class="nav-link mr-3" href="/">Prices</a>
            </li>
            <li class="nav-item mr-3">
              <a class="nav-link" href="/btc-range">BTC Range</a>
            </li>
          </ul>
        </div>
      </nav>
    <!--Navbar end-->

    <!-- Coins List Table start -->
    <div class="card" style="width: 100%;">
        <div class="card-body">
          <table class="table table-striped table-hover table-dark" id="coins_list">
            <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">Name</th>
                  <th scope="col">Symbol</th>
                  <th scope="col">Price (USD)</th>
                  <th scope="col">Today</th>
                  <th scope="col">24H High</th>
                  <th scope="col">24H Low</th>
                  <th scope="col">Market Cap</th>
                  <th scope="col">Total Volume</th>
                </tr>
            </thead>
            <tbody id>
              {% for coin in data %}
              <tr id="{{coin['symbol']}}">
                <td>{{ coin["market_cap_rank"] }}</td>
                <td>
                    <img src="{{ coin['image'] }}" alt="" style="height: 25px; width: 25px">
                    {{ coin["name"] }}
                </td>
                <td>{{ coin["symbol"] }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    
    <!-- Coins List Table end -->

</body>
</html>

<!--Bootstrap-->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" 
integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" 
crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" 
integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" 
crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" 
integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" 
crossorigin="anonymous"></script>

<!-- Reload -->
<script>
  var url = "https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=20&page=1&sparkline=false"

  async function getList() {
    const response = await fetch(url)
    const data = await response.json()
    console.log(data)

      document.querySelectorAll('.delete').forEach(function(a) {
          a.remove()
      })

    for(var i=0; i<data.length; i++) {
      tr = document.getElementById(data[i]['symbol'])

      td = document.createElement('td')
      tr.appendChild(td)
      td.innerHTML = '$'+data[i]['current_price']
      td.className = "delete"

      td = document.createElement('td')
      tr.appendChild(td)
      if(parseFloat(data[i]['price_change_percentage_24h']) < 0) {
        td.innerHTML = "<img src='https://img.icons8.com/ios-glyphs/25/fa314a/circled-chevron-down.png'/> "+data[i]['price_change_percentage_24h']
      } else {
        td.innerHTML = "<img src='https://img.icons8.com/ios-glyphs/25/26e07f/circled-chevron-up.png'/> "+data[i]['price_change_percentage_24h']
      }
      td.className = "delete"

      td = document.createElement('td')
      tr.appendChild(td)
      td.innerHTML = '$'+data[i]['high_24h']
      td.className = "delete"

      td = document.createElement('td')
      tr.appendChild(td)
      td.innerHTML = '$'+data[i]['low_24h']
      td.className = "delete"

      td = document.createElement('td')
      tr.appendChild(td)
      td.innerHTML = '$'+data[i]['market_cap']
      td.className = "delete"

      td = document.createElement('td')
      tr.appendChild(td)
      td.innerHTML = data[i]['total_volume']
      td.className = "delete"
    }
  }

  getList()
  setInterval(getList, 5000)
</script>